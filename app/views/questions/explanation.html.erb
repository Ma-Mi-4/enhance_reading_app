<% content_for :body_attributes do %>
  data-page="explanation" data-turbo="false"
<% end %>

<div class="max-w-3xl mx-auto px-4 py-8">

  <!-- タイトル -->
  <h1 class="text-2xl font-bold text-center mb-8">
    解説：<%= @question_set.title %>
  </h1>

  <!-- Part7 本文 -->
  <div class="mb-10 text-gray-800 leading-relaxed">
    <%= simple_format(@question_set.content) %>
  </div>

  <% @questions.each_with_index do |q, index| %>
    <div class="mb-12">

      <!-- 問題文 -->
      <p class="mb-3 text-base font-medium">
        問題 <%= index + 1 %>：
        <span class="font-normal"><%= q[:body] %></span>
      </p>

      <!-- 正解 -->
      <div class="mb-4 p-4 rounded-md bg-green-50 border border-green-200">
        <p class="font-semibold text-green-700">
          正解：<%= q[:choices][q[:correct_index]] %>
        </p>
      </div>

      <!-- 間違いの選択肢 -->
      <h2 class="text-sm font-semibold text-gray-700 mb-2">
        間違いの選択肢と解説
      </h2>

      <div class="space-y-3 mb-6">
        <% q[:choices].each_with_index do |choice, i| %>
          <% next if i == q[:correct_index] %>

          <% wrong_explanation =
               q[:wrong_explanations].present? ?
                 q[:wrong_explanations][i] : nil %>

          <div class="p-3 border rounded-md bg-gray-50">
            <p class="text-sm leading-relaxed">
              <span class="font-medium"><%= choice %></span>：
              <%= wrong_explanation.presence || "（解説なし）" %>
            </p>
          </div>
        <% end %>
      </div>

      <!-- 正解の解説 -->
      <% if q[:explanation].present? %>
        <div class="mb-4">
          <p class="font-semibold mb-1">解説</p>
          <p class="leading-relaxed text-gray-800">
            <%= q[:explanation] %>
          </p>
        </div>
      <% end %>

      <!-- 例文 -->
      <% if q[:example_sentence].present? %>
        <div class="mt-3 text-sm text-gray-600 leading-relaxed">
          <span class="font-semibold">例文：</span>
          <%= q[:example_sentence] %>
        </div>
      <% end %>

    </div>
  <% end %>

  <% quiz_set = QuizSet.find_by(question_set_id: @question_set.id) %>

  <% if quiz_set.present? %>
    <div class="text-center mt-10">
      <%= link_to "復習問題へ",
            quiz_path(quiz_set.uuid),
            class: "btn-outline mt-4" %>
    </div>
  <% end %>

</div>
