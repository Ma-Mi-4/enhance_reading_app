<meta name="turbo-cache-control" content="no-cache">

<h1><%= @date.strftime('%Y年%m月') %></h1>

<div style="margin-bottom: 16px;">
  <%= link_to "前の月", calendars_path(month: @date.prev_month), class: "btn btn-secondary" %>
  <%= link_to "次の月", calendars_path(month: @date.next_month), class: "btn btn-secondary" %>
</div>

<div class="dashboard">
  <!-- カレンダー -->
  <div class="calendar-container">
    <table class="calendar-table">
      <tr>
        <% ['日','月','火','水','木','金','土'].each_with_index do |d,i| %>
          <th style="<%= 'color:red;' if i == 0 %><%= 'color:blue;' if i == 6 %>"><%= d %></th>
        <% end %>
      </tr>

      <% @first_wday.times do %>
        <td></td>
      <% end %>

      <% @days.each do |current_date| %>
        <td>
          <%= link_to current_date.day, calendar_day_path(date: current_date), class: "calendar-day-link" %>
        </td>
        <% if current_date.saturday? %></tr><tr><% end %>
      <% end %>
    </table>
  </div>

  <!-- 学習グラフ -->
  <div class="study-container">
    <h2>今月の学習時間・予想スコア</h2>
    <canvas id="studyChart"
        data-study='<%= raw(@study_data.to_json) %>'>
    </canvas>

    <!-- 今月の集計表示 -->
    <div class="month-summary" style="margin-top:16px;">
      <p>今月の学習時間合計: <%= @month_summary[:total_duration] %> 分</p>
      <p>今月の正答率: <%= @month_summary[:average_accuracy] %> %</p>
      <p>今月の予想スコア: <%= @month_summary[:predicted_score] %> 点</p>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<br>
<%= link_to "メイン画面へ戻る", main_path, class: "btn btn-primary" %>

