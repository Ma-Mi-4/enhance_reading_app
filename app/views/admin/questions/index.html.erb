<div class="max-w-5xl mx-auto px-4 py-8">

  <!-- タイトル -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">
      問題管理（管理者用）
    </h1>

    <%= link_to "新規作成",
          new_admin_question_path,
          class: "inline-block px-4 py-2
                  bg-blue-600 text-white rounded-md
                  hover:bg-blue-700 transition" %>
  </div>

  <% if @all_questions.any? %>
    <div class="overflow-x-auto bg-white border rounded-lg">
      <table class="min-w-full text-sm">

        <thead class="bg-gray-100 text-gray-700">
          <tr>
            <th class="px-3 py-2 text-left">ID</th>
            <th class="px-3 py-2 text-left">タイトル</th>
            <th class="px-3 py-2 text-left">レベル</th>
            <th class="px-3 py-2 text-left">種類 / カテゴリ</th>
            <th class="px-3 py-2 text-left">内容</th>
            <th class="px-3 py-2 text-left">作成日</th>
            <th class="px-3 py-2 text-left">更新日</th>
            <th class="px-3 py-2 text-left">操作</th>
          </tr>
        </thead>

        <tbody class="divide-y">
          <% @all_questions.each do |q| %>
            <tr class="hover:bg-gray-50">

              <td class="px-3 py-2">
                <%= q["source"] == "db" ? q["id"] : "-" %>
              </td>

              <td class="px-3 py-2 font-medium">
                <%= q["title"] %>
              </td>

              <td class="px-3 py-2">
                <%= q["level"] %>
              </td>

              <td class="px-3 py-2">
                <%= q["source"] == "db" ? q["kind"] : q["category"] %>
              </td>

              <td class="px-3 py-2 text-gray-600">
                <%= truncate(
                      JSON.pretty_generate(q["content"] || q["questions"] || {}),
                      length: 80
                    ) %>
              </td>

              <td class="px-3 py-2">
                <%= q["source"] == "db" ? q["created_at"].strftime("%Y-%m-%d %H:%M") : "-" %>
              </td>

              <td class="px-3 py-2">
                <%= q["source"] == "db" ? q["updated_at"].strftime("%Y-%m-%d %H:%M") : "-" %>
              </td>

              <td class="px-3 py-2 space-x-2">
                <% if q["source"] == "db" %>
                  <%= link_to "詳細",
                        admin_question_path(q["id"]),
                        class: "text-blue-600 hover:underline" %>

                  <%= link_to "編集",
                        edit_admin_question_path(q["id"]),
                        class: "text-yellow-600 hover:underline" %>

                  <%= link_to "削除",
                        admin_question_path(q["id"]),
                        data: {
                          turbo_method: :delete,
                          turbo_confirm: "本当に削除しますか？"
                        },
                        class: "text-red-600 hover:underline" %>
                <% else %>
                  <span class="text-gray-400">
                    JSONファイル
                  </span>
                <% end %>
              </td>

            </tr>
          <% end %>
        </tbody>

      </table>
    </div>
  <% else %>
    <p class="text-gray-600">
      登録されている問題はありません。
    </p>
  <% end %>

</div>
