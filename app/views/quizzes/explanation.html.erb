<% content_for :body_attributes do %>
  data-page="explanation"
<% end %>

<div class="max-w-3xl mx-auto px-4 py-8">

  <!-- タイトル -->
  <h1 class="text-2xl font-bold text-center mb-8">
    復習解説
  </h1>

  <% @questions.each_with_index do |q, idx| %>
    <div class="mb-12">

      <!-- 問題番号 -->
      <p class="mb-3 text-base font-medium">
        問題 <%= idx + 1 %>
      </p>

      <!-- 正解 -->
      <div class="mb-4 p-4 rounded-md bg-green-50 border border-green-50">
        <p class="font-semibold text-green-700 leading-relaxed">
          正解：
          <%= q[:choices][q[:correct_index]] %><br>
          <span class="font-normal">
            <%= q[:explanation_list][q[:correct_index]] %>
          </span>
        </p>
      </div>

      <!-- 選択肢別解説 -->
      <h2 class="text-sm font-semibold text-gray-700 mb-2">
        選択肢別の解説
      </h2>

      <div class="space-y-3 mb-6">
        <% q[:choices].each_with_index do |choice, i| %>
          <% next if i == q[:correct_index] %>

          <div class="p-3 border border-gray-200 rounded-md bg-gray-50">
            <p class="text-sm leading-relaxed">
              <span class="font-medium"><%= choice %></span>：
              <%= q[:explanation_list][i].presence || "（解説なし）" %>
            </p>
          </div>
        <% end %>
      </div>

      <!-- 例文 -->
      <% if q[:example_sentence].present? %>
        <div class="mt-3 text-sm text-gray-600 leading-relaxed">
          <span class="font-semibold">例文：</span>
          <%= q[:example_sentence] %>
        </div>
      <% end %>

    </div>
  <% end %>

  <!-- 行動ボタン -->
  <div class="space-y-4 mt-14 text-center">

    <%= link_to "学習を終了してカレンダーへ",
          calendars_path,
          class: "border border-blue-400 text-blue-600 px-6 py-2 rounded-md
                 hover:bg-blue-50 transition text-sm" %>

    <%= link_to "次の問題へ",
          question_path(
            (
              QuestionSet.where(level: current_user.level)
                         .where("id > ?", @current_qs_id)
                         .first ||
              QuestionSet.where(level: current_user.level).first
            ).uuid
          ),
          class: "btn-outline mt-4" %>

  </div>

</div>
